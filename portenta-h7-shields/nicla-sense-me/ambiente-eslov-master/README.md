# Ambiente Eslov Master - Arduino Portenta H7 with Nicla Sense ME

A comprehensive environmental monitoring system that bridges the Nicla Sense ME sensor shield with Arduino IoT Cloud and provides local web-based sensor data visualization.

## Overview

This sketch runs on an **Arduino Portenta H7** board (Host/Master) with a **Nicla Sense ME** shield attached via ESLOV connector. It acts as an I2C bridge to read environmental sensor data and transmit it to Arduino IoT Cloud, while also serving a web interface for local data access.

## Hardware Requirements

- **Arduino Portenta H7** - Main host board
- **Nicla Sense ME** - Environmental sensor shield (connected via ESLOV I2C)
- **WiFi capabilities** - Built-in WiFi module on Portenta H7
- **USB Serial connection** - For debugging and programming

## Features

### Sensors Supported

The sketch reads data from the following environmental sensors on Nicla Sense ME:

- **Temperature** - Temperature sensor with calibration (converted to °C)
- **Humidity** - Relative humidity sensor with calibration
- **Pressure** - Barometric pressure sensor
- **Gas** - Gas quality sensor (VOC, CO₂)
- **IAQ** - Indoor Air Quality index (via BSEC sensor)

### Cloud Integration

- **Arduino IoT Cloud** - Real-time sensor data transmission
- Read-only properties updated every 5 seconds
- Compatible with Arduino IoT Cloud Dashboards for live monitoring and charts

### Local Web Interface

- Built-in HTTP web server on port 80
- Displays current temperature with modern dark-themed UI
- Auto-refreshing page every 10 seconds
- mDNS support for easy network discovery (`arduino.local`)

### Network Features

- WiFi connectivity with WPA support
- mDNS (Bonjour) service registration for easy discovery
- WiFi signal strength monitoring
- Network status printing (SSID, IP address, subnet, gateway)

## Installation

### 1. Arduino Setup

1. Install Arduino IDE or Arduino Cloud Editor
2. Add Portenta H7 board to your IDE:
   - Board Manager → Search "Portenta H7" → Install
3. Select board: **Arduino Portenta H7**
4. Select port: USB port where Portenta H7 is connected

### 2. Required Libraries

Install these libraries via Arduino Library Manager:

- `Arduino_BHY2Host` - Nicla Sense ME sensor support
- `ArduinoIoTCloud` - Arduino IoT Cloud connectivity
- `Arduino_ConnectionHandler` - WiFi connection handling
- `ArduinoMDNS` - mDNS/Bonjour support

### 3. Configuration Files

#### `arduino_secrets.h`

Create this file with your WiFi and Arduino IoT Cloud credentials:

```cpp
#define SECRET_ID "YOUR_THING_ID"
#define SECRET_SSID "YOUR_WIFI_SSID"
#define SECRET_PASS "YOUR_WIFI_PASSWORD"
```

**To get your THING_ID:**
1. Create a device in Arduino IoT Cloud
2. Create a Thing with the following properties:
   - `temperature` (float, READ only)
   - `humidity` (int, READ only)
   - `pressure` (int, READ only)
   - `gas` (int, READ only)
   - `iaq` (int, READ only)
3. Copy the THING_ID from your Cloud dashboard

#### `thingProperties.h`

Defines the Arduino IoT Cloud properties and WiFi connection handler. This file should be auto-generated by Arduino IoT Cloud, but ensure it includes all five sensor properties.

### 4. Upload

1. Copy the three files into a sketch folder:
   - `ambiente-eslov-master.ino`
   - `arduino_secrets.h`
   - `thingProperties.h`

2. Verify and upload:
   - Upload sketch to Portenta H7
   - Open Serial Monitor (115200 baud) to see connection status

## Usage

### Serial Output

The sketch prints diagnostic information via serial (115200 baud):

```
Attempting to connect to SSID: MyNetwork
Connected to WiFi
SSID: MyNetwork
IP Address: 192.168.1.100
...
Connecting to the Arduino IoT Cloud
T25.34
H55.22
P1013.45
```

### Arduino IoT Cloud

1. Go to your Arduino IoT Cloud dashboard
2. Create a Dashboard widget to visualize sensor data:
   - Temperature gauge
   - Humidity line chart
   - Pressure indicator
   - Air quality metrics

### Web Interface

1. Open browser and navigate to:
   - `http://arduino.local` (if mDNS is working)
   - `http://<IP_ADDRESS>` (where IP_ADDRESS is from serial output)

2. View current temperature and environment status

## Calibration

The sketch applies calibration formulas to raw sensor values:

- **Temperature:** `T = 1.0095 * raw_value - 4.8051`
- **Humidity:** `H = 1.4383 * raw_value - 2.5628`
- **Pressure:** `P = (0.718/100 * raw_value) + raw_value`

Adjust these values if you need to recalibrate for your specific sensors.

## Slave Device Support

This is the **Master** sketch. If you have a corresponding **Slave** device (see `ambiente-eslov-slave`), that device will provide raw sensor data which this master reads and processes.

## Pin Connections

- **Nicla Sense ME** → Portenta H7 via ESLOV connector
  - I2C SDA/SCL communication
  - Power supplied through ESLOV

## Debug Mode

To enable detailed debugging, modify the sketch:

```cpp
#define DEBUG true
```

This will print additional information about:
- I2C communication
- Sensor initialization
- Data transmission status
- WiFi connection details

## Troubleshooting

| Issue | Solution |
|-------|----------|
| "Communication with WiFi module failed!" | Ensure Portenta H7 has WiFi module, check USB connection |
| Cannot connect to WiFi | Verify SSID and password in `arduino_secrets.h` |
| Cannot reach Arduino IoT Cloud | Check WiFi connection, verify THING_ID is correct |
| Sensors show no data | Ensure Nicla Sense ME is properly connected via ESLOV, check I2C address |
| Web page not loading | Try accessing via IP address instead of `arduino.local`, check firewall |

## Technical Details

- **Serial Baud Rate:** 115200 bps
- **Cloud Update Interval:** 5 seconds per property
- **Sensor Reading Interval:** 10 seconds
- **Web Server Port:** 80 (HTTP)
- **mDNS Hostname:** arduino.local

## License

See LICENSE file in this directory.

## References

- [Arduino Portenta H7 Documentation](https://docs.arduino.cc/hardware/portenta-h7)
- [Nicla Sense ME Documentation](https://docs.arduino.cc/hardware/nicla-sense-me)
- [Arduino IoT Cloud](https://create.arduino.cc/iot)
- [Arduino Cloud REST API](https://create.arduino.cc/iot/api/docs)
